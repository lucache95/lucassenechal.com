---
phase: 02-subscriber-onboarding
plan: 03
type: execute
wave: 2
depends_on: [02-01]
files_modified:
  - components/onboarding/step-delivery.tsx
  - components/onboarding/step-sources.tsx
autonomous: true
requirements: [SIGN-04, SIGN-05, SIGN-06, SIGN-07, COPY-02]

must_haves:
  truths:
    - "Subscriber can choose from three delivery time slots (Morning, Afternoon, Evening) with timezone auto-detected"
    - "Subscriber can enter their city for local content personalization"
    - "Subscriber can add RSS/Atom feed URLs that are validated as HTTP/HTTPS only"
    - "Subscriber sees a benefits pitch for SMS before the phone number input is revealed"
    - "SMS opt-in reveals phone input only after subscriber shows interest"
    - "All step headers and CTAs use F/G/E microcopy"
  artifacts:
    - path: "components/onboarding/step-delivery.tsx"
      provides: "Delivery time selector with 3 presets and city/timezone input"
      contains: "morning"
    - path: "components/onboarding/step-sources.tsx"
      provides: "RSS feed URL input and SMS opt-in with benefits pitch"
      contains: "smsOptIn"
  key_links:
    - from: "components/onboarding/step-delivery.tsx"
      to: "components/onboarding/stepper.tsx"
      via: "receives onUpdate/onNext/onBack props from stepper"
      pattern: "onUpdate|onNext|onBack"
    - from: "components/onboarding/step-sources.tsx"
      to: "lib/schemas/onboarding.ts"
      via: "URL validation uses same rules as Zod schema"
      pattern: "url|feed"
---

<objective>
Build the Delivery Time & Location step (Step 3) and Sources & SMS step (Step 4) with full F/G/E microcopy, completing the preference collection steps of the onboarding flow.

Purpose: These steps collect the operational preferences (when/where/what sources) and the SMS opt-in. The SMS step in particular needs careful UX -- benefits pitch first, then phone input reveal -- to maximize opt-in rates without being pushy.

Output: Two complete step components that plug into the existing stepper from Plan 02.
</objective>

<execution_context>
@/Users/lucassenechal/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lucassenechal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-subscriber-onboarding/02-RESEARCH.md
@.planning/phases/02-subscriber-onboarding/02-01-SUMMARY.md
@lib/schemas/onboarding.ts
@components/ui/button.tsx
@components/ui/input.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build Delivery Time & Location step</name>
  <files>components/onboarding/step-delivery.tsx</files>
  <action>
    'use client' component. Step 3 of the onboarding flow.

    **F/G/E header:** "When and where should we find things for you?" (greed-framed -- personalization as a service).
    **Subtext:** "We'll deliver your briefing right when you want it, with local finds from your area." (ego -- bespoke delivery).

    **Delivery Time Section:**
    Three large selectable cards/buttons for time slots:
    1. **Morning** (~7:00 AM) -- "Start your day ahead of everyone" (ego). Icon: sunrise/coffee.
    2. **Afternoon** (~12:00 PM) -- "Catch up over lunch" (casual greed). Icon: sun.
    3. **Evening** (~6:00 PM) -- "End your day informed" (fear of missing out). Icon: moon/sunset.

    Show detected timezone below the time cards: "Delivering in your timezone: America/New_York" (or whatever was auto-detected). Use `Intl.DateTimeFormat().resolvedOptions().timeZone` -- already captured in stepper state on mount.

    Default selection: 'morning'. Store in `state.data.deliveryTime`.

    **Location Section:**
    Label: "Your city (optional)" with subtext: "Unlocks local events, deals, and news in your area."
    Simple text input for city name. No autocomplete API per RESEARCH.md (Google Places unavailable to new customers).
    Placeholder: "e.g., Austin, TX"
    Store in `state.data.city`. Max 100 chars.

    This step is skippable -- sensible defaults (morning + auto-detected timezone) apply if skipped.

    Style time cards similar to format cards from Step 2 -- consistent selection UX with highlight border and Framer Motion selection animation.
  </action>
  <verify>`npm run build` passes. Step 3 renders with three time cards and city input. Time default is morning. Timezone displays correctly. City input accepts text. Selecting a different time updates the visual state.</verify>
  <done>Delivery Time step shows 3 time slot cards with F/G/E copy, displays auto-detected timezone, and provides city text input. Default is morning. All values persist in stepper state.</done>
</task>

<task type="auto">
  <name>Task 2: Build Sources & SMS step</name>
  <files>components/onboarding/step-sources.tsx</files>
  <action>
    'use client' component. Step 4 of the onboarding flow.

    **F/G/E header:** "Supercharge your briefing" (greed-framed -- power-up language).
    **Subtext:** "Add your own sources and get alerts on the go." (ego -- you're in control).

    **RSS/Atom Feeds Section:**
    Label: "Custom sources (optional)"
    Description: "Paste RSS or Atom feed URLs and we'll monitor them daily for you. Get insights others won't even know exist." (greed + ego).

    Dynamic input list:
    - One URL input visible by default with placeholder "https://example.com/feed.xml"
    - "Add another source" button to add more URL inputs
    - Each URL input has a remove button (X) except if it's the only one and empty
    - Client-side validation: check URL format with `new URL()` constructor, verify protocol is http: or https: only (per RESEARCH.md -- SSRF prevention). Show inline error for invalid URLs.
    - Do NOT fetch/validate the feed at signup time (that's Phase 3). Only validate URL format.
    - Store valid URLs in `state.data.feedUrls` array.

    **SMS Opt-In Section:**
    This is NOT just a toggle. Per CONTEXT.md: "Dedicated mini-section with a benefits pitch explaining what they'll get before revealing the phone number input."

    Benefits pitch card (always visible):
    Header: "Get briefing alerts on your phone" (greed).
    Three benefit bullets with icons:
    - "Breaking alerts when big news drops in your topics" (fear of missing)
    - "Quick daily summaries you can read in 30 seconds" (greed for efficiency)
    - "Ask follow-up questions about your report via text" (ego -- AI at your fingertips)

    CTA button: "Yes, add SMS alerts" / "No thanks" toggle. When "Yes" is clicked:
    - Reveal phone number input with smooth Framer Motion expand animation
    - Phone input with placeholder "+1 (555) 123-4567"
    - Note below: "We'll only text you about your briefing. Reply STOP anytime."
    - Basic phone validation: non-empty if opted in, rough E.164 format check (starts with + or digits, 7-15 digits)
    - Store `smsOptIn: true` and `phone` in state.

    If "No thanks": `smsOptIn: false`, phone stays empty. This is the default.

    This step is fully skippable -- no sources and no SMS is a valid choice.
  </action>
  <verify>`npm run build` passes. Step 4 renders with RSS URL input and SMS section. Adding a URL with invalid format shows error. Adding "https://example.com/feed.xml" is accepted. SMS benefits pitch is visible. Clicking "Yes, add SMS alerts" reveals phone input with animation. Phone input accepts numbers.</verify>
  <done>Sources step has dynamic RSS URL inputs with client-side format validation. SMS section shows benefits pitch first, reveals phone input only on opt-in. Both sections fully functional with F/G/E copy throughout.</done>
</task>

</tasks>

<verification>
- `npm run build` succeeds
- Step 3 (Delivery) renders 3 time cards with morning default
- Auto-detected timezone displays correctly
- City input accepts text
- Step 4 (Sources) renders RSS URL input field
- Invalid URLs show inline validation error
- Valid URLs are accepted and stored
- "Add another source" adds new input fields
- SMS benefits pitch renders with 3 bullet points
- "Yes, add SMS alerts" reveals phone input with animation
- "No thanks" hides phone input
- Both steps preserve state when navigating back/forward
</verification>

<success_criteria>
Subscriber can set delivery time preference from 3 slots, enter city for local content, add RSS/Atom feed URLs with format validation, and opt into SMS with a benefits-first pitch that reveals the phone input only on interest. All copy follows F/G/E framework.
</success_criteria>

<output>
After completion, create `.planning/phases/02-subscriber-onboarding/02-03-SUMMARY.md`
</output>
